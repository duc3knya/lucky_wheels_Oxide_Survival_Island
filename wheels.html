<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Oxide Lucky Wheel ‚Äì D3KN</title>
<style>
  body {
    background:#2b2b2b;
    color:#fff;
    text-align:center;
    font-family:Arial, sans-serif;
    margin:0;
  }
  canvas {
    margin-top:60px;
    background:#3a3a3a;
    border-radius:50%;
  }
  button {
    margin-top:10px;
    padding:10px 24px;
    font-size:18px;
    cursor:pointer;
  }
  input[type=range] {
    width:300px;
  }

  /* GUIDE */
  #helpBtn {
    position:fixed;
    top:10px;
    right:10px;
    background:#444;
    color:#fff;
    border:none;
    border-radius:6px;
    padding:8px 14px;
    font-size:14px;
    cursor:pointer;
    z-index:1000;
  }
  #helpOverlay {
    display:none;
    position:fixed;
    top:0; left:0;
    width:100%; height:100%;
    background:rgba(0,0,0,0.85);
    z-index:999;
  }
  #helpBox {
    position:absolute;
    top:50%; left:50%;
    transform:translate(-50%,-50%);
    width:420px;
    background:#2f2f2f;
    border-radius:10px;
    padding:20px;
    text-align:left;
    line-height:1.6;
  }
  #helpBox h3 {
    margin-top:0;
    text-align:center;
  }
  #closeHelp {
    float:right;
    cursor:pointer;
    color:#ff8080;
    font-weight:bold;
  }
</style>
</head>
<body>

<button id="helpBtn" onclick="openHelp()">H∆Ø·ªöNG D·∫™N</button>

<div id="helpOverlay">
  <div id="helpBox">
    <span id="closeHelp" onclick="closeHelp()">‚úñ</span>
    <h3>üìò H∆Ø·ªöNG D·∫™N S·ª¨ D·ª§NG</h3>

    <b>1Ô∏è‚É£ C√°ch nh·∫≠n bi·∫øt s·ªë th·ª© t·ª± √¥</b><br>
    - √î <b>s·ªë 1</b> l√† √¥ 20 <b> ( t√≠nh theo chi·ªÅu kim ƒë·ªìng h·ªì )</b><br>
    - Ti·∫øp theo s·∫Ω l√† 1 ( √¥ 2 ), 5 ( √¥ 3 ).. </b><br>
    - ƒê·∫øm √¥ theo <b>chi·ªÅu kim ƒë·ªìng h·ªì</b><br>
    - M·ªói √¥ c√≥ gi√° tr·ªã: <br>
    &nbsp;&nbsp;‚Ä¢ 1 (v√†ng) &nbsp;‚Ä¢ 3 (xanh l√°)<br>
    &nbsp;&nbsp;‚Ä¢ 5 (xanh n∆∞·ªõc) &nbsp;‚Ä¢ 10 (ƒë·ªè) &nbsp;‚Ä¢ 20 (h·ªìng)

    <hr>

    <b>2Ô∏è‚É£ Ch·ªânh √¥ m·ª•c ti√™u</b><br>
    - Nh·∫≠p s·ªë √¥ (1‚Äì24) v√†o √¥ <b>‚Äú√î m·ª•c ti√™u‚Äù</b><br>
    - B·∫•m <b>EDIT</b><br>
    ‚Üí Tam gi√°c s·∫Ω ch·ªâ ƒë√∫ng √¥ b·∫°n ch·ªçn

    <hr>

    <b>3Ô∏è‚É£ Ch·ªânh l·ªách tr√°i / ph·∫£i</b><br>
    - K√©o thanh <b>L·ªách tr√°i / ph·∫£i</b><br>
    - √Çm (‚àí) ‚Üí l·ªách sang <b>tr√°i</b><br>
    - D∆∞∆°ng (+) ‚Üí l·ªách sang <b>ph·∫£i</b><br>
    - D√πng ƒë·ªÉ test s√°t v·∫°ch gi·ªØa 2 √¥

    <hr>

    <b>4Ô∏è‚É£ Quay v√≤ng</b><br>
    - B·∫•m <b>SPIN</b> ƒë·ªÉ quay<br>
    - K·∫øt qu·∫£ hi·ªÉn th·ªã theo ƒë√∫ng √¥ tam gi√°c ch·ªâ

  </div>
</div>

<h2>Lucky WHEEL ‚Äì DUC3KYA | Oxide Survival Island</h2>
<canvas id="wheel" width="520" height="520"></canvas><br>

<button onclick="spin()">SPIN</button>

<div style="margin-top:15px;">
  <label>√î m·ª•c ti√™u:</label>
  <input id="targetSlot" type="number" min="1" max="24" value="1" style="width:60px;">
  <br><br>

  <label>L·ªách tr√°i / ph·∫£i:</label><br>
  <input id="offsetSlider" type="range" min="-1" max="1" step="0.01" value="0">
  <div>L·ªách: <span id="offsetValue">0</span></div>

  <button onclick="alignToTarget()">EDIT</button>
</div>

<p id="result"></p>

<script>
// ================== HELP ==================
function openHelp() {
  document.getElementById("helpOverlay").style.display = "block";
}
function closeHelp() {
  document.getElementById("helpOverlay").style.display = "none";
}

// ================== DATA ==================
const values = [
  20, 1, 5, 1, 3, 1, 5, 1,
  10, 1, 3, 1, 5, 1, 3, 1,
  10, 1, 3, 1, 5, 1, 3, 1
];

// ================== COLOR ==================
function getColor(val) {
  if (val === 1)  return "#d4c72a";
  if (val === 3)  return "#2e8b57";
  if (val === 5)  return "#2f6fd6";
  if (val === 10) return "#b13a2c";
  if (val === 20) return "#8e3a8c";
}

// ================== CANVAS ==================
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");

const center = 260;
const radius = 235;
const innerRadius = 120;
const slice = 2 * Math.PI / values.length;
const OFFSET = -Math.PI / 2;

let angle = 0;

// ================== DRAW ==================
function drawWheel() {
  ctx.clearRect(0,0,520,520);

  for (let i = 0; i < values.length; i++) {
    const startAngle = OFFSET + angle + i * slice;
    const endAngle   = OFFSET + angle + (i + 1) * slice;

    ctx.beginPath();
    ctx.moveTo(center, center);
    ctx.fillStyle = getColor(values[i]);
    ctx.arc(center, center, radius, startAngle, endAngle);
    ctx.closePath();
    ctx.fill();

    ctx.strokeStyle = "#000";
    ctx.lineWidth = 2;
    ctx.stroke();

    ctx.save();
    ctx.translate(center, center);
    ctx.rotate(startAngle + slice / 2);
    ctx.fillStyle = "#111";
    ctx.font = "bold 18px Arial";
    ctx.textAlign = "right";
    ctx.fillText(values[i], radius - 25, 6);
    ctx.restore();
  }

  ctx.beginPath();
  ctx.fillStyle = "#4b2f1a";
  ctx.arc(center, center, innerRadius, 0, 2*Math.PI);
  ctx.fill();

  ctx.fillStyle="#eee";
  ctx.beginPath();
  ctx.arc(center, center, 3, 0, 2*Math.PI);
  ctx.fill();

  ctx.fillStyle = "#3b2a1a";
  ctx.beginPath();
  ctx.moveTo(center, 52);
  ctx.lineTo(center-14, 20);
  ctx.lineTo(center+14, 20);
  ctx.closePath();
  ctx.fill();
}

// ================== SPIN ==================
function spin() {
  const spins = Math.random()*2200 + 3600;
  const start = angle;
  const end = start + spins * Math.PI / 180;
  const duration = 3500;
  let startTime = null;

  function animate(t) {
    if (!startTime) startTime = t;
    const p = Math.min((t - startTime) / duration, 1);

    angle = start + (end - start) * (1 - Math.pow(1 - p, 3));
    drawWheel();

    if (p < 1) {
      requestAnimationFrame(animate);
    } else {
      const TWO_PI = 2 * Math.PI;
      const a = ((angle % TWO_PI) + TWO_PI) % TWO_PI;
      let index = Math.floor((TWO_PI - a) / slice) % values.length;
      index = (index + values.length) % values.length;

      document.getElementById("result").innerText =
        `K·∫æT QU·∫¢: √î ${index + 1} ‚Üí ${values[index]}`;
    }
  }

  requestAnimationFrame(animate);
}

// ================== ALIGN ==================
function alignToTarget() {
  const slot = parseInt(document.getElementById("targetSlot").value);
  const offsetRatio = parseFloat(document.getElementById("offsetSlider").value);
  if (slot < 1 || slot > values.length) return;

  const targetAngle = (slot - 1) * slice + slice / 2;
  const offsetAngle = offsetRatio * slice;

  angle = -(targetAngle + offsetAngle);
  drawWheel();
}

document.getElementById("offsetSlider").addEventListener("input", e => {
  document.getElementById("offsetValue").innerText = e.target.value;
});

// ================== INIT ==================
drawWheel();
</script>

</body>
</html>
